# --------------------------------------------------------------
# docker-compose.yml
# --------------------------------------------------------------
version: "3.9"

services:
  # ----------------------------------------------------------
  # Open‑WebUI – the LLM UI + tool runner
  # ----------------------------------------------------------
  openwebui:
    build:
      context: ./docker/openwebui
    container_name: openwebui
    ports:
      - "8080:8080"            # UI reachable at http://localhost:8080
    environment:
      # OPTIONAL – if you run a local Ollama instance for the model
      # OLLAMA_HOST: http://host.docker.internal:11434
      ENABLE_TOOLS: "true"    # required so the LLM can call custom tools
    depends_on:
      - mock_gaits
      - auth_proxy
    restart: unless-stopped

  # ----------------------------------------------------------
  # Mock GAITS – mimics the real GAITS REST API
  # ----------------------------------------------------------
  mock_gaits:
    build:
      context: ./docker/mock_gaits
    container_name: mock_gaits
    ports:
      - "8001:8000"            # host 8001 → container 8000
    volumes:
      - ./data:/data:ro        # mount the sample Excel file read‑only
    # No environment variables needed now → give an empty mapping
    environment: {}            # <-- this line satisfies the “must be a mapping” rule
    restart: unless-stopped

  # ----------------------------------------------------------
  # Auth Proxy – tiny service that pretends to be SSO / role service
  # ----------------------------------------------------------
  auth_proxy:
    build:
      context: ./docker/auth_proxy
    container_name: auth_proxy
    ports:
      - "8002:8000"            # host 8002 → container 8000
    restart: unless-stopped

  # ----------------------------------------------------------
  # (Optional) PostgreSQL – you can enable it later if you want a
  # persistent store instead of SQLite.
  # ----------------------------------------------------------
  # postgres:
  #   image: postgres:15-alpine
  #   container_name: postgres
  #   environment:
  #     POSTGRES_USER: gaits_user
  #     POSTGRES_PASSWORD: secret
  #     POSTGRES_DB: gaits
  #   volumes:
  #     - pgdata:/var/lib/postgresql/data
  #   restart: unless-stopped

# ----------------------------------------------------------------
# Volumes (only needed if you enable the postgres service)
# ----------------------------------------------------------------
# volumes:
#   pgdata: